export function Scroller(n){var o=[],e={},r=n.scenes,t=n.container,i=n.offset,c=0;function u(n,o){for(var r=0,t=(e[n]||[]).slice();r<t.length;r++)t[r](o)}return null==i&&(i=.5),{on:function(n,o){(e[n]||(e[n]=[])).push(o)},off:function(n,o){var r=e[n]||[];r.length&&r.splice(r.indexOf(o)>>>0,1)},init:function(){var n,e,f,s,l=-100*(1-i)+"% 0px "+-100*i+"%";for(f=new IntersectionObserver((function(r){for(i=window.pageYOffset,s=i>c,c=i,n=0;n<r.length;n++)f=r[n],e=f.target,l=e===t?"container:":"scene:",u(l+=f.isIntersecting?"enter":"exit",{bounds:f.boundingClientRect,index:o.indexOf(e),isScrollingDown:s,element:e})}),{rootMargin:l}),n=0;n<r.length;n++)o.push(e=r[n]),f.observe(e);t&&f.observe(t),u("init")},o:u}}export function Progress(n){var o=n.scenes,e=n.offset;null==e&&(e=.5);var r=e*window.innerHeight,t=new Map,i=Scroller({scenes:o,offset:e});return i.on("scene:enter",(function(n){t.set(n.element,function(n,o){function e(){var e=n.getBoundingClientRect(),t=e.top,i=e.bottom,c=(r-t)/(i-t);o({bounds:e,element:n,progress:Math.max(0,Math.min(c,1))})}return window.addEventListener("scroll",e,!1),function(){window.removeEventListener("scroll",e,!1)}}(n.element,(function(n){i.o("scene:progress",n)})))})),i.on("scene:exit",(function(n){var o=t.get(n.element);o&&(console.log("unobserved",n.element),o())})),{on:function(n,o){i&&i.on(n,o)},init:function(){i.init()}}}